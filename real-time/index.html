<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			body { 
        margin: 0; 
      }
			canvas { 
        width: 100%; 
        height: 100% 
      }
		</style>
	</head>
	<body>
      <input type="file" id="file-input" />
      <h3>Contents of the file:</h3>
      <pre id="file-content"></pre>
		<script src="js/three.min.js"></script>
		<script>
      
      /*
      var reader = new FileReader();
      reader.onload = function(event) {
        var contents = event.target.result;
        console.log("File contents: " + contents);
      };

      reader.onerror = function(event) {
        console.error("File could not be read! Code " + event.target.error.code);
      };

      reader.readAsText(file);
      */
      function readSingleFile(e) {
        console.log("e: ",e);
        var file = e.target.files[0];
        if (!file) {
          return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
          var contents = e.target.result;
          var array = contents.split("\n");
          console.log(array, array.length);
          for (var i=0; i<array.length; ++i) {
            var point = array[i].split(" ")
            console.log(i,point);

          }

          //displayContents(contents);
        };
        reader.readAsText(file);
      }

      document.getElementById('file-input').addEventListener('change', readSingleFile, false);
      //console.log().addEventListener('change',readSingleFile,false);




			var bgColor = 0xf0f1f2;

      var scene = new THREE.Scene();

      var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000 );
      camera.position.set(0,0,450);

      var renderer = new THREE.WebGLRenderer({
        antialias:true
      });
      renderer.setClearColor( bgColor );
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      var group = new THREE.Object3D();

      window.addEventListener( 'resize', onWindowResize, false );

      function onWindowResize() {        
        camera.left = window.innerWidth / - 2;
        camera.right = window.innerWidth / 2;
        camera.top = window.innerHeight / 2;
        camera.bottom = window.innerHeight / - 2;
        camera.aspect = window.innerWidth / window.innerHeight;        

        renderer.setSize( window.innerWidth, window.innerHeight );
      }

      function readSingleFile(e) {
        console.log("e: ",e);
        var file = e.target.files[0];
        if (!file) {
          return;
        }
        var reader = new FileReader();
        reader.onload = function(e) {
          var contents = e.target.result;
          var array = contents.split("\n");
          console.log(array, array.length);
          for (var i=0; i<array.length; ++i) {
            var point = array[i].split(" ")
            console.log(i,point);
            var geometry = new THREE.SphereGeometry(1.5,6,6);
            var material = new THREE.MeshBasicMaterial({
              color: 0x1a1a1a
            });
            var mesh = new THREE.Mesh(geometry, material);  //Mesh - Objects formed using lines (similar)
            mesh.position.x = point[0];
            mesh.position.y = point[1];
            mesh.position.z = point[2];
            group.add(mesh);  

          }
        };
        reader.readAsText(file);
      }
      
      //**Code to zoom in and out on scroll - currently not working **//
      var startX, startY, target = $(renderer.domElement), selected;

      function mouseUp(e) {
        e = e.originalEvent || e;
        e.preventDefault();

        var x = ( e.touches ? e.touches[0].clientX : e.clientX ),
          y = ( e.touches ? e.touches[0].clientY : e.clientY ),
          diff = Math.max(Math.abs(startX - x), Math.abs(startY - y));

        if ( diff > 40 ) { return; }

        var mouse = {
          x: ( x / window.innerWidth ) * 2 - 1,
          y: - ( y / window.innerHeight ) * 2 + 1
        };

        var vector = new THREE.Vector3( mouse.x, mouse.y ).unproject( camera );
        var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );
        var intersects = raycaster.intersectObject( scene, true );

        if ( intersects.length > 0 && intersects[ 0 ].object !== selected ) {
          selected = intersects[ 0 ].object;
          camera.zoom(selected);
        } else {
          selected = null;
          camera.reset(); 
        }
      }

      function mouseDown( e ) {
        e = e.originalEvent || e;
        startX = ( e.touches ? e.touches[0].clientX : e.clientX );
        startY = ( e.touches ? e.touches[0].clientY : e.clientY );

        target.one('mouseup touchend', mouseUp );

        setTimeout(function(){ target.off('mouseup.part touchend.part'); },300);
      }

      target.on('mousedown touchend', mouseDown );
      /************************************************/

      scene.add(group);

      function update() {
        //var rotateX = group.rotation.x + 0.002;
        //var rotateY = group.rotation.y + 0.005;
        //var rotateZ = group.rotation.z + 0.01;
        //group.rotation.set( rotateX, rotateY, rotateZ );

        camera.lookAt(scene.position);
        renderer.render(scene,camera);

        requestAnimationFrame(update);
      }
      update();
    </script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/TrackballControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>
	</body>
</html>